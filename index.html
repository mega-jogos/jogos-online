<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Damas Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .menu {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-criar {
            background: #28a745;
            color: white;
        }

        .btn-criar:hover {
            background: #218838;
        }

        .btn-entrar {
            background: #007bff;
            color: white;
        }

        .btn-entrar:hover {
            background: #0056b3;
        }

        .sala-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        .codigo-display {
            font-size: 48px;
            font-weight: bold;
            letter-spacing: 10px;
            color: #333;
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin: 10px 0;
            border: 2px dashed #007bff;
        }

        .input-codigo {
            width: 200px;
            padding: 10px;
            font-size: 24px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            aspect-ratio: 1;
            background: #deb887;
            border: 3px solid #8b4513;
            margin-bottom: 20px;
        }

        .square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .square.dark {
            background: #8b4513;
        }

        .square.light {
            background: #deb887;
        }

        .piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .piece.red {
            background: #ff4444;
            border: 2px solid #cc0000;
        }

        .piece.black {
            background: #333;
            border: 2px solid #000;
        }

        .piece.king {
            position: relative;
        }

        .piece.king::after {
            content: "‚ôî";
            color: gold;
            font-size: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .selected {
            box-shadow: 0 0 0 3px #ffd700;
        }

        .valid-move {
            position: relative;
        }

        .valid-move::after {
            content: "";
            width: 30%;
            height: 30%;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .status {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .jogadores {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .jogador {
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            flex: 1;
            margin: 0 5px;
            text-align: center;
        }

        .jogador.ativo {
            background: #28a745;
            color: white;
        }

        .hidden {
            display: none;
        }

        .aguardando {
            color: #ffc107;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Jogo de Damas Online üéÆ</h1>
        
        <div class="menu">
            <button class="btn-criar" onclick="criarSala()">Criar Sala (C√≥digo 4 d√≠gitos)</button>
            <button class="btn-entrar" onclick="mostrarEntrar()">Entrar na Sala</button>
        </div>

        <!-- √Årea da Sala Criada -->
        <div id="salaCriada" class="sala-section hidden">
            <h3>‚úÖ Sala Criada!</h3>
            <p>Compartilhe este c√≥digo de 4 d√≠gitos com seu amigo:</p>
            <div class="codigo-display" id="codigoSala"></div>
            <p class="aguardando" id="aguardandoMsg">‚è≥ Aguardando oponente entrar...</p>
        </div>

        <!-- √Årea para Entrar -->
        <div id="entrarSala" class="sala-section hidden">
            <h3>üîë Digite o c√≥digo da sala:</h3>
            <input type="text" class="input-codigo" id="inputCodigo" maxlength="4" placeholder="0000" autocomplete="off">
            <button class="btn-entrar" onclick="entrarSala()" style="display: block; margin: 10px auto;">Entrar na Sala</button>
            <button onclick="voltarMenu()" style="margin-top: 10px; background: #6c757d; color: white;">Voltar</button>
        </div>

        <!-- √Årea do Jogo -->
        <div id="jogoArea" class="hidden">
            <div class="jogadores">
                <div class="jogador" id="jogador1">üü• Jogador 1 (Vermelho)</div>
                <div class="jogador" id="jogador2">‚¨õ Jogador 2 (Preto)</div>
            </div>
            
            <div class="status" id="status">Carregando jogo...</div>
            
            <div class="board" id="board"></div>
        </div>
    </div>

    <script>
        // SIMULA√á√ÉO DE BANCO DE DADOS LOCAL
        // Isso substitui o Firebase que estava com problemas
        
        let salas = {}; // Objeto para armazenar as salas em mem√≥ria
        
        // Gerar ID √∫nico para cada jogador
        let meuId = 'jogador_' + Math.random().toString(36).substr(2, 9);
        let salaAtual = null;
        let minhaCor = null;
        let pecaSelecionada = null;
        let movimentosValidos = [];
        
        // Intervalo para verificar atualiza√ß√µes
        let intervaloAtualizacao = null;

        // Fun√ß√£o para criar sala com c√≥digo de 4 d√≠gitos
        function criarSala() {
            // Gerar c√≥digo aleat√≥rio de 4 d√≠gitos
            let codigo = Math.floor(1000 + Math.random() * 9000).toString();
            
            // Criar tabuleiro inicial
            let tabuleiroInicial = criarTabuleiro();
            
            // Criar objeto da sala
            salas[codigo] = {
                criador: meuId,
                jogadores: {
                    jogador1: {
                        id: meuId,
                        nome: 'Jogador 1',
                        cor: 'red'
                    }
                },
                status: 'aguardando',
                tabuleiro: tabuleiroInicial,
                vez: 'red'
            };
            
            // Mostrar c√≥digo da sala
            salaAtual = codigo;
            minhaCor = 'red';
            
            document.getElementById('codigoSala').textContent = codigo;
            document.getElementById('salaCriada').classList.remove('hidden');
            document.getElementById('entrarSala').classList.add('hidden');
            
            // Come√ßar a verificar se algu√©m entrou na sala
            verificarSala(codigo);
            
            alert('Sala criada com sucesso! C√≥digo: ' + codigo);
        }

        // Mostrar campo para entrar na sala
        function mostrarEntrar() {
            document.getElementById('entrarSala').classList.remove('hidden');
            document.getElementById('salaCriada').classList.add('hidden');
            document.getElementById('inputCodigo').value = '';
        }

        // Voltar ao menu
        function voltarMenu() {
            document.getElementById('entrarSala').classList.add('hidden');
        }

        // Fun√ß√£o para entrar na sala
        function entrarSala() {
            let codigo = document.getElementById('inputCodigo').value.trim();
            
            if (codigo.length !== 4) {
                alert('Digite um c√≥digo v√°lido de 4 d√≠gitos!');
                return;
            }

            // Verificar se a sala existe no objeto local
            if (salas[codigo]) {
                const sala = salas[codigo];
                
                // Verificar se a sala est√° dispon√≠vel
                if (sala.status === 'aguardando' && !sala.jogadores.jogador2) {
                    // Adicionar jogador 2
                    sala.jogadores.jogador2 = {
                        id: meuId,
                        nome: 'Jogador 2',
                        cor: 'black'
                    };
                    sala.status = 'jogando';
                    
                    salaAtual = codigo;
                    minhaCor = 'black';
                    
                    // Esconder telas de cria√ß√£o/entrada
                    document.getElementById('salaCriada').classList.add('hidden');
                    document.getElementById('entrarSala').classList.add('hidden');
                    
                    // Mostrar jogo
                    mostrarJogo(sala);
                    
                    alert('Voc√™ entrou na sala ' + codigo + '!');
                } else {
                    alert('Sala indispon√≠vel! Ela j√° pode estar cheia.');
                }
            } else {
                alert('Sala n√£o encontrada! Verifique o c√≥digo.');
            }
        }

        // Fun√ß√£o para verificar se algu√©m entrou na sala (para quem criou)
        function verificarSala(codigo) {
            if (intervaloAtualizacao) {
                clearInterval(intervaloAtualizacao);
            }
            
            intervaloAtualizacao = setInterval(() => {
                if (salas[codigo] && salas[codigo].status === 'jogando') {
                    // Algu√©m entrou na sala!
                    clearInterval(intervaloAtualizacao);
                    mostrarJogo(salas[codigo]);
                }
            }, 1000);
        }

        // Fun√ß√£o para mostrar o jogo
        function mostrarJogo(sala) {
            document.getElementById('jogoArea').classList.remove('hidden');
            document.getElementById('salaCriada').classList.add('hidden');
            
            // Atualizar informa√ß√µes dos jogadores
            document.getElementById('jogador1').innerHTML = 'üü• Jogador 1 (Vermelho)';
            document.getElementById('jogador2').innerHTML = '‚¨õ Jogador 2 (Preto)';
            
            // Atualizar status
            document.getElementById('status').innerHTML = 'Vez das pe√ßas: üü• VERMELHAS';
            
            // Destacar jogador atual
            document.getElementById('jogador1').classList.add('ativo');
            document.getElementById('jogador2').classList.remove('ativo');
            
            // Renderizar tabuleiro
            renderizarTabuleiro(sala.tabuleiro);
        }

        // Fun√ß√£o para criar tabuleiro inicial
        function criarTabuleiro() {
            let tabuleiro = [];
            
            // Inicializar tabuleiro vazio
            for (let i = 0; i < 8; i++) {
                tabuleiro[i] = [];
                for (let j = 0; j < 8; j++) {
                    tabuleiro[i][j] = null;
                }
            }

            // Posicionar pe√ßas vermelhas (parte de cima)
            for (let linha = 0; linha < 3; linha++) {
                for (let coluna = 0; coluna < 8; coluna++) {
                    if ((linha + coluna) % 2 === 1) {
                        tabuleiro[linha][coluna] = { cor: 'red', dama: false };
                    }
                }
            }

            // Posicionar pe√ßas pretas (parte de baixo)
            for (let linha = 5; linha < 8; linha++) {
                for (let coluna = 0; coluna < 8; coluna++) {
                    if ((linha + coluna) % 2 === 1) {
                        tabuleiro[linha][coluna] = { cor: 'black', dama: false };
                    }
                }
            }

            return tabuleiro;
        }

        // Fun√ß√£o para renderizar tabuleiro
        function renderizarTabuleiro(tabuleiro) {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';

            for (let linha = 0; linha < 8; linha++) {
                for (let coluna = 0; coluna < 8; coluna++) {
                    const square = document.createElement('div');
                    square.className = `square ${(linha + coluna) % 2 === 0 ? 'light' : 'dark'}`;
                    square.dataset.linha = linha;
                    square.dataset.coluna = coluna;

                    const peca = tabuleiro[linha][coluna];
                    if (peca) {
                        const pecaElement = document.createElement('div');
                        pecaElement.className = `piece ${peca.cor} ${peca.dama ? 'king' : ''}`;
                        square.appendChild(pecaElement);
                    }

                    // Destacar pe√ßa selecionada
                    if (pecaSelecionada && pecaSelecionada.linha === linha && pecaSelecionada.coluna === coluna) {
                        square.classList.add('selected');
                    }

                    // Destacar movimentos v√°lidos
                    if (movimentosValidos.some(m => m.linha === linha && m.coluna === coluna)) {
                        square.classList.add('valid-move');
                    }

                    square.onclick = () => cliqueTabuleiro(linha, coluna);
                    boardElement.appendChild(square);
                }
            }
        }

        // Fun√ß√£o para clique no tabuleiro
        function cliqueTabuleiro(linha, coluna) {
            if (!salaAtual) return;
            
            const sala = salas[salaAtual];
            if (!sala) return;

            // Verificar se √© minha vez
            if (sala.vez !== minhaCor) {
                alert('Agora n√£o √© sua vez!');
                return;
            }

            // Verificar se os dois jogadores est√£o na sala
            if (!sala.jogadores.jogador2) {
                alert('Aguardando segundo jogador...');
                return;
            }

            const tabuleiro = sala.tabuleiro;
            const peca = tabuleiro[linha][coluna];

            // Se n√£o tem pe√ßa selecionada, tenta selecionar uma pe√ßa
            if (!pecaSelecionada) {
                if (peca && peca.cor === minhaCor) {
                    pecaSelecionada = { linha, coluna };
                    calcularMovimentosValidos(linha, coluna, tabuleiro);
                    renderizarTabuleiro(tabuleiro);
                }
            } 
            // Se tem pe√ßa selecionada, tenta mover
            else {
                if (movimentoValido(pecaSelecionada, { linha, coluna })) {
                    // Fazer o movimento
                    let novoTabuleiro = JSON.parse(JSON.stringify(tabuleiro));
                    
                    // Mover a pe√ßa
                    novoTabuleiro[linha][coluna] = novoTabuleiro[pecaSelecionada.linha][pecaSelecionada.coluna];
                    novoTabuleiro[pecaSelecionada.linha][pecaSelecionada.coluna] = null;

                    // Verificar se houve captura
                    if (Math.abs(linha - pecaSelecionada.linha) === 2) {
                        let linhaCaptura = (pecaSelecionada.linha + linha) / 2;
                        let colunaCaptura = (pecaSelecionada.coluna + coluna) / 2;
                        novoTabuleiro[linhaCaptura][colunaCaptura] = null;
                    }

                    // Verificar se virou dama
                    if (minhaCor === 'red' && linha === 7) {
                        novoTabuleiro[linha][coluna].dama = true;
                    }
                    if (minhaCor === 'black' && linha === 0) {
                        novoTabuleiro[linha][coluna].dama = true;
                    }

                    // Atualizar tabuleiro na sala
                    sala.tabuleiro = novoTabuleiro;
                    sala.vez = minhaCor === 'red' ? 'black' : 'red';

                    // Atualizar interface
                    atualizarInterface(sala);

                    pecaSelecionada = null;
                    movimentosValidos = [];
                } else {
                    // Se clicou em lugar inv√°lido, desseleciona
                    pecaSelecionada = null;
                    movimentosValidos = [];
                }
                renderizarTabuleiro(tabuleiro);
            }
        }

        // Fun√ß√£o para atualizar interface
        function atualizarInterface(sala) {
            // Atualizar status
            let vezTexto = sala.vez === 'red' ? 'üü• VERMELHAS' : '‚¨õ PRETAS';
            document.getElementById('status').innerHTML = `Vez das pe√ßas: ${vezTexto}`;
            
            // Destacar jogador atual
            if (sala.vez === 'red') {
                document.getElementById('jogador1').classList.add('ativo');
                document.getElementById('jogador2').classList.remove('ativo');
            } else {
                document.getElementById('jogador2').classList.add('ativo');
                document.getElementById('jogador1').classList.remove('ativo');
            }
            
            // Renderizar tabuleiro
            renderizarTabuleiro(sala.tabuleiro);
        }

        // Fun√ß√£o para calcular movimentos v√°lidos
        function calcularMovimentosValidos(linha, coluna, tabuleiro) {
            movimentosValidos = [];
            const peca = tabuleiro[linha][coluna];
            if (!peca) return;

            // Dire√ß√µes b√°sicas
            let direcoes = [];
            if (peca.cor === 'red') {
                direcoes = [[1, -1], [1, 1]];
            } else {
                direcoes = [[-1, -1], [-1, 1]];
            }

            // Se for dama, pode andar em todas as dire√ß√µes
            if (peca.dama) {
                direcoes = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
            }

            // Verificar cada dire√ß√£o
            direcoes.forEach(([dLinha, dColuna]) => {
                let novaLinha = linha + dLinha;
                let novaColuna = coluna + dColuna;

                // Movimento simples
                if (novaLinha >= 0 && novaLinha < 8 && novaColuna >= 0 && novaColuna < 8) {
                    if (!tabuleiro[novaLinha][novaColuna]) {
                        movimentosValidos.push({ linha: novaLinha, coluna: novaColuna });
                    }
                }

                // Captura
                let linhaPulo = linha + (dLinha * 2);
                let colunaPulo = coluna + (dColuna * 2);
                let linhaMeio = linha + dLinha;
                let colunaMeio = coluna + dColuna;

                if (linhaPulo >= 0 && linhaPulo < 8 && colunaPulo >= 0 && colunaPulo < 8) {
                    let pecaMeio = tabuleiro[linhaMeio][colunaMeio];
                    let pecaDestino = tabuleiro[linhaPulo][colunaPulo];
                    
                    if (pecaMeio && pecaMeio.cor !== peca.cor && !pecaDestino) {
                        movimentosValidos.push({ linha: linhaPulo, coluna: colunaPulo });
                    }
                }
            });
        }

        // Fun√ß√£o para verificar se movimento √© v√°lido
        function movimentoValido(de, para) {
            return movimentosValidos.some(m => m.linha === para.linha && m.coluna === para.coluna);
        }
    </script>
</body>
</html>